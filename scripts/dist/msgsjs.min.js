function msg_ajax(s,e){$.ajax({url:"/controllers/_messages.php",type:"post",dataType:"json",data:{action:s,msgID:e},success:function(s,e){if("1"!=s)return s},error:function(s,e,t){console.log(s),console.log("Details: "+e+"\nError:"+t)}})}$(function(){var s=[],e=8e3;$(".messages .messages-list #msg_arch").click(function(t){t.stopImmediatePropagation(),$p=$(this).closest(".message-row"),msg_id=$p.attr("msg-id");var o="\t\t\t\t<li class='ui compact positive message' id='"+msg_id+"'>\t\t\t\t<p>Message has been deleted...<span id='msg-undo'><b>undo</b></span></p>\t\t\t\t</li>";$p.toggle(300),$("#msgs-msg").show(),$("#msgs-msg").append(o),msg_ajax("msg_hide",msg_id),s.push(msg_id),$(".message#"+v).delay(e).fadeOut(350)}),$(document).on("click","span#msg-undo",function(){uid=$(this).parents("li").attr("id"),msg_ajax("msg_unhide",uid),$("#msgid-"+uid).toggle(),$(this).closest("li.message").remove()})}),$(function(){$(".messages #undo-msg").click(function(s){s.stopImmediatePropagation(),$p=$(this).closest(".message-row"),msg_id=$p.attr("msg-id"),$p.toggle(300),msg_ajax("msg_unhide",msg_id)})}),$(function(){$(".messages #msg_remove").click(function(s){s.stopImmediatePropagation(),$p=$(this).closest(".message-row"),msg_id=$p.attr("msg-id"),$p.remove(),msg_ajax("msg_remove",msg_id)})}),$(function(){var s=!1;$("#send_msg").submit(function(e){if(e.preventDefault(),e.stopPropagation(),_form=$(this),!s){if(s=!0,value=$("#msg_context").val(),token=$("#msg_token").val(),send_to=$("#send_to").val(),value.length<=0)return console.log("msg can't be empty"),!1;_form.addClass("loading"),$.ajax({url:"/controllers/_messages.php",type:"post",dataType:"json",data:{action:"msg_send",value:value,token:token,send_to:send_to},success:function(s,e){"1"==s.status?_form.parent().load("/controllers/inc/msg-send-success.php"):(console.log(s),_form.removeClass("loading"),_form.parent().load("/controllers/inc/msg-send-fail.php","msg="+s))},error:function(s,e,t){_form.removeClass("loading"),console.log(s),console.log("Details: "+e+"\nError:"+t)}})}})}),$(function(){$(".messages .msg-main .msg-user_info #msg_arch").click(function(s){s.stopImmediatePropagation(),msg_id=getUrlVars(),msg_id=msg_id.msg,$(".dropdown").dropdown("hide"),$.ajax({url:"/controllers/_messages.php",type:"post",dataType:"json",data:{action:"msg_hide",msgID:msg_id},success:function(s,e){return"1"!=s.status?s:($dp="\t\t\t\t\t\t<div class='item' id='msg_unarch'>\t\t\t\t\t\t\t<a class='ui a'>unArchive</a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class='item' id='post-edit'>\t\t\t\t\t\t\t<a class='ui a'>Delete</a>\t\t\t\t\t\t</div>",$(".container.section.messages").prepend("<div id='msg_msg'></div>"),$("#msg_msg").load("/controllers/inc/msg-arch-success.php"),$arch='<i title="This message is archived" class="archive icon"></i>',$(".messages .msg-user_info div.time").after($arch),$(".msg-main .menu").children().remove(),$(".msg-main .menu").append($dp),void 0)},error:function(s,e,t){console.log(s),console.log("Details: "+e+"\nError:"+t)}})})}),$(function(){$(document).on("click",".messages .msg-main .msg-user_info #msg_unarch",function(s){s.stopImmediatePropagation(),msg_id=getUrlVars(),msg_id=msg_id.msg,msg_ajax("msg_unhide",msg_id),location="/messages/?sh=inb",window.location.replace(location)})}),$(function(){$(document).on("click",".messages .msg-main .msg-user_info #msg_unread",function(s){s.stopImmediatePropagation(),msg_id=getUrlVars(),msg_id=msg_id.msg,msg_ajax("msg_unread",msg_id);var e="/messages/";window.location=e})}),$(function(){$(".messages .msg-main .msg-user_info #msg_block").click(function(s){s.stopImmediatePropagation(),msg_id=getUrlVars(),msg_id=msg_id.msg,$msg_v=!1,$(".dropdown").dropdown("hide"),$.ajax({url:"/controllers/_messages.php",type:"post",dataType:"json",data:{action:"msg_block",msgID:msg_id},success:function(s,e){$msg=$("#msg_msg"),$msg.length&&$msg.remove(),"1"==s.status?($(".container.section.messages").prepend("<div id='msg_msg'></div>"),$("#msg_msg").load("/controllers/inc/user-block-success.php")):($(".container.section.messages").prepend("<div id='msg_msg'></div>"),$("#msg_msg").load("/controllers/inc/user-block-fail.php","msg="+s))},error:function(s,e,t){console.log(s),console.log("Details: "+e+"\nError:"+t)}})})}),$(function(){$(".messages #user_unblock").click(function(){_this=$(this),uid=_this.closest(".item").attr("user-id"),$.ajax({url:"/controllers/_messages.php",type:"post",dataType:"json",data:{action:"unblock",msgID:uid},success:function(s,e){return"1"!=s.status?s:void _this.closest(".item").fadeOut(250,function(){this.remove()})},error:function(s,e,t){console.log(s),console.log("Details: "+e+"\nError:"+t)}})})}),$(function(){$(".messages-list tr").each(function(){$dateE=$(this).find("#msg_date"),$dateE.text(moment($dateE.text()).fromNow())})}),$(function(){$("#s_msg_date").text(moment($("#s_msg_date").text()).fromNow())}),$(function(){function s(s){var e="<a href='/user/"+s.id+"' class='ui image label'>\t\t\t\t<img src='"+s.image+"'>\t\t\t\t"+s.title+"\t\t\t\t<i class='delete icon'></i>\t\t\t\t</a>";return e}var e,t=!1;_search=$(".ui.search"),_search.search({minCharacters:2,apiSettings:{url:"/controllers/_messages.php?un={query}"},onSelect:function(o){t||(e=o,console.log(e),_search.search("cancel query"),input=$(this).find("input")[0],$(input).before(s(e)),console.log(e.id),$(input).attr("type","hidden"),$(input).next().toggle(),t=!0)}}),$(document).on("click","#msg_sendto .delete.icon",function(s){s.preventDefault(),$(this).parent().remove(),$(input).attr("type","text"),$(input).attr("value",""),$(input).next().toggle(),t=!1})}),$(function(){_form=$("#msg_compose"),_form.form({on:"submit",inline:!0,fields:{send_to:{identifier:"send_to",rules:[{type:"empty",prompt:"Search for a user"}]},content:{identifier:"content",rules:[{type:"empty",prompt:"Subject can't be empty."}]}}});var s=!1;_form.submit(function(e){if(e.preventDefault(),e.stopPropagation(),valid=_form.form("is valid"),!valid)return void console.log("form is not valid");if(!s){if(s=!0,user=$(".ui.search").search("get result"),content=$("#msg_context").val(),token=$("#msg_token").val(),!user)return _form.form("add prompt","send_to","No user was selected."),console.log("No user was selected."),s=!1,!1;if(content.length<=0)return console.log("msg can't be empty"),s=!1,!1;_form.addClass("loading"),$.ajax({url:"/controllers/_messages.php",type:"post",dataType:"json",data:{action:"msg_send",value:content,token:token,send_to:user.id},success:function(s,e){"1"==s.status?_form.parent().load("/controllers/inc/msg-send-success.php"):(console.log(s),_form.removeClass("loading"),_form.parent().load("/controllers/inc/msg-send-fail.php","msg="+s))},error:function(s,e,t){_form.removeClass("loading"),console.log(s),console.log("Details: "+e+"\nError:"+t)}})}})});